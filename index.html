<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>
        浙传校园临时通行码
    </title>
    <link rel="stylesheet" href="PAGES/css/new_file.css" />
    <script src="resource/jquery-1.11.1.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        var ewmzt = 0;//二维码状态

        var qjcs = 0;//二维码状态

        var bm = '浙江传媒学院/学生/媒体工程学院学院/数字媒体技术/20数字媒体技术3班';//二维码状态
        $(window).load(function () {
            //if (qjcs >= 2) {
            //    $('#button2').attr("disabled", true);
            //    $('#button2').css("background-color", "gray");
            //    $("#button2").text('每周仅2次免审批机会');


            //}
            console.log(bm);

            if (bm.search("成教") != -1) {
                $('#button3').css("display", "block");
            }


            //$('#button2').attr("disabled", true);
            //    $('#button2').css("background-color", "gray");
            //    $("#button2").text('免审批申请功能已关闭');

            if (ewmzt == 4) {
                $("#viewConttainer1").attr("src", "PAGES/img/err.jpg");
                $('#button1').attr("disabled", true);
                $('#button1').css("background-color", "gray");
                $('#button2').attr("disabled", true);
                $('#button2').css("background-color", "gray");
                $('#button3').attr("disabled", true);
                $('#button3').css("background-color", "gray");
            }
            else if (ewmzt == 1 || ewmzt == 2) {
                var hqguid = document.getElementById("GUI").innerText;
                var rgb1 = "";
                var rgb2 = "";
                var rgb3 = "";

                var rgb1 = 155;
                var rgb2 = 89;
                var rgb3 = 182;
                $.ajax({
                    type: "post",
                    url: '/WebServices/JXM.asmx/returnXSQJEWM',
                    contentType: "application/json; charset=utf-8",
                    data: '{ "guid1s": "' + hqguid + '","zt":' + ewmzt + ',"rgb1":' + rgb1 + ',"rgb2":' + rgb2 + ',"rgb3":' + rgb3 + '}',
                    dateType: "json",
                    success: function (ewm) {
                        console.log(ewm);
                        // console.log(ewm);
                        //var ssss = ewm.all[0].innerHTML;
                        var ssss = ewm.d;
                        console.log(ssss);
                        ssss = ssss.replace(/[\r\n]/g, "");
                        $("#viewConttainer1").attr("src", "data:image/png;base64," + ssss);

                    }
                });
            } else if (ewmzt == 7) {
                var hqguid = document.getElementById("GUI").innerText;
                var rgb1 = "";
                var rgb2 = "";
                var rgb3 = "";

                var rgb1 = 50;
                var rgb2 = 194;
                var rgb3 = 221;
                $('#button1').attr("disabled", true);
                $('#button1').css("background-color", "gray");
                $('#button2').attr("disabled", true);
                $('#button2').css("background-color", "gray");

                $.ajax({
                    type: "post",
                    url: '/WebServices/JXM.asmx/returnXSQJEWM',
                    contentType: "application/json; charset=utf-8",
                    data: '{ "guid1s": "' + hqguid + '","zt":' + ewmzt + ',"rgb1":' + rgb1 + ',"rgb2":' + rgb2 + ',"rgb3":' + rgb3 + '}',
                    dateType: "json",
                    success: function (ewm) {
                        console.log(ewm);
                        // console.log(ewm);
                        //var ssss = ewm.all[0].innerHTML;
                        var ssss = ewm.d;
                        console.log(ssss);
                        ssss = ssss.replace(/[\r\n]/g, "");
                        $("#viewConttainer1").attr("src", "data:image/png;base64," + ssss);

                    }
                });
            }
            else if (ewmzt == 6) {
                $("#viewConttainer1").attr("src", "PAGES/img/err.jpg");
                $('#button1').attr("disabled", true);
                $('#button1').css("background-color", "gray");
                $('#button2').attr("disabled", true);
                $('#button2').css("background-color", "gray");
                $('#button3').attr("disabled", true);
                $('#button3').css("background-color", "gray");
            }
            else {
                $("#viewConttainer1").attr("src", "PAGES/img/err.jpg");
            }



            setInterval(() => {
                var date = new Date();
                var year = date.getFullYear();
                var month = date.getMonth() + 1;
                var day = date.getDate();
                var hour = date.getHours();
                var minute = date.getMinutes();
                var second = date.getSeconds();

                //  console.log(year + "-" + month + "月" + day+"日");
                //  console.log(hour + ":" + minute + ":" + second);
                document.getElementById("rq").innerText = month + "月" + day + "日";
                document.getElementById("sj").innerText = hour + ":" + minute + ":" + second;
            }, 1000);

            var date1 = new Date();
            var year1 = date1.getFullYear();
            var month1 = date1.getMonth() + 1;
            var day1 = date1.getDate();
            var hour1 = date1.getHours();
            var minute1 = date1.getMinutes();
            var second1 = date1.getSeconds();

            //hour1 = 23;
            //minute1 = 9;
            //second1 = 2;

            if (((hour1 + 2) * 60 + minute1) <= 1350) {
                document.getElementById("time").innerText = "通行时间：" + year1 + "-" + month1 + "-" + day1 + " " + ((hour1 - 2 + 24) % 24).toString().padStart(2, '0') + ":" + minute1.toString().padStart(2, '0') + "-" + year1 + "/" + month1 + "/" +( day1+2) + " " + ((hour1 + 2 + 24) % 24).toString().padStart(2, '0') + ":" + minute1.toString().padStart(2, '0') + ":00";
            }
            else {
                document.getElementById("time").innerText = "通行时间：" + year1 + "-" + month1 + "-" + day1 + " " + ((hour1 - 2 + 24) % 24).toString().padStart(2, '0') + ":" + minute1.toString().padStart(2, '0') + "-" + year1 + "/" + month1 + "/" + (day1+2) + " " + "22:30:00";
            }
        })



    </script>
</head>



<body>

    <div class="max">
        <span id="GUI" style="display:none"></span>
        <span id="SZXQ" style="display:none"></span>
        <span class="max-span">守护校园 &nbsp; &nbsp; &nbsp; &nbsp;人人有责</span>
        <div class="max-sk"></div>
        <div class="max-sk-nz">
            <span class="max-sk-nz-zt" style="margin-top: 20px;">姓名：周时贤</span>
            <span class="max-sk-nz-zt">班级：20数字媒体技术3班</span>


            <span class="max-sk-nz-sj"
                style="display:block;width: 100%;height: 70px;color: #000000;font-size: 110px;text-align: center;font-weight: bold;float: left;margin-top: 20px;"
                id="rq"></span></br>
            <span class="max-sk-nz-sj"
                style="display:block;width: 100%;height: 70px;color: #000000;font-size: 110px;text-align: center;font-weight: bold;float: left;margin-top:30px;"
                id="sj"></span>

            <div class="max-sk-nz-ewm">
                <div class="ewm"><img id="viewConttainer1" style="width:100%;height:100%" src=''></div><!-- 二维码 -->
            </div>

            <span class="max-sk-nz-ztss" style="margin-top: 10px;font-size:35px;margin-bottom:30px;" id="time"></span>

            <button class="anniu" id="button1"
                onclick="window.location.href = 'http://ehall.cuz.edu.cn:7705/steppages/pview.aspx?p=浙传学生外出请假审批'"
                style="margin-top: 30px;display:block;">报备申请</button>

            <button class="anniu1" id="button2"
                onclick="window.location.href = 'http://ehall.cuz.edu.cn:7705/steppages/pview.aspx?p=浙传学生外出请假审批&ismsp=1'"
                style="display:block;">免审批报备</button>
            <button class="anniu1" id="button3"
                onclick="window.location.href = 'http://ehall.cuz.edu.cn:7705/Pages/Detail.aspx?ID=068de453bd214c6c847e5f305bbf37f0'"
                style="display:none;">学期结束离校</button>
			<button class="anniu1" id="button2"
			    onclick="window.location.href = 'http://ehall.cuz.edu.cn:7705/steppages/pview.aspx?p=浙传学生外出请假审批&ismsp=1'"
			    style="display:block;">出省报备</button>

            <span class="max-sk-nz-ztss" style="margin-top: 30px;display:block">健康码为绿码</span>





        </div>

    </div>

</body>

</html>
